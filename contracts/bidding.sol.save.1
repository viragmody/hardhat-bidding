pragma solidity ^0.7.3;
import "./escrow.sol";
import "hardhat/console.sol";

contract Bidding {
    // event4bid
    // event4initalize
    address public owner;
    uint public _balance;
    address public _winningBidder;
    uint public _winningBid;
    struct auction {
        uint bidMin;
        uint duration;
        uint deadline;
        string description;
    }
    Escrow public escrowAddr;
    auction[] public Auctions;

    constructor(uint _bidMin, uint _minutes, string memory _description) public {
        owner = msg.sender;
        escrowAddr = new Escrow();
        auction memory Auction = auction({
            bidMin: _bidMin,
            duration: _minutes,
            deadline : block.timestamp + (_minutes * 1 minutes),
            description: _description
        });
        Auctions.push(Auction);
        console.log("bidMin is");
    }
    function depositBid() external payable {
        address bidder = (msg.sender);
        escrowAddr.record{value: msg.value}(payable(bidder));
        // emit4bid
    }

    function test() external {
//        _balance = escrowAddr.balance();
        _winningBidder = escrowAddr.winningBid();
        _winningBid = escrowAddr.winningBidAmount();
    }

    function closeBid() public returns(uint) {
        // require(block.timestamp >= Auctions[0].deadline);
        escrowAddr.release();
    }

}
